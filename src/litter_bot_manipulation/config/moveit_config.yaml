# MoveIt 2 Configuration for OpenMANIPULATOR-X

robot_description_semantic:
  robot_description_semantic: |
    <?xml version="1.0" ?>
    <robot name="litter_bot">
      <!-- Planning Groups -->
      <group name="arm">
        <joint name="joint1"/>
        <joint name="joint2"/>
        <joint name="joint3"/>
        <joint name="joint4"/>
      </group>
      
      <group name="gripper">
        <joint name="gripper_left_joint"/>
        <joint name="gripper_right_joint"/>
      </group>
      
      <!-- End Effector -->
      <end_effector name="gripper_ee" parent_link="gripper_base_link" group="gripper"/>
      
      <!-- Disable Collisions -->
      <disable_collisions link1="base_link" link2="arm_base_link" reason="Adjacent"/>
      <disable_collisions link1="arm_base_link" link2="link1" reason="Adjacent"/>
      <disable_collisions link1="link1" link2="link2" reason="Adjacent"/>
      <disable_collisions link1="link2" link2="link3" reason="Adjacent"/>
      <disable_collisions link1="link3" link2="link4" reason="Adjacent"/>
      <disable_collisions link1="link4" link2="gripper_base_link" reason="Adjacent"/>
      <disable_collisions link1="gripper_base_link" link2="gripper_left_link" reason="Adjacent"/>
      <disable_collisions link1="gripper_base_link" link2="gripper_right_link" reason="Adjacent"/>
      <disable_collisions link1="base_link" link2="left_wheel_link" reason="Adjacent"/>
      <disable_collisions link1="base_link" link2="right_wheel_link" reason="Adjacent"/>
      <disable_collisions link1="base_link" link2="caster_link" reason="Adjacent"/>
      <disable_collisions link1="base_link" link2="base_scan" reason="Adjacent"/>
      <disable_collisions link1="base_link" link2="camera_link" reason="Adjacent"/>
      <disable_collisions link1="base_link" link2="collection_bin_link" reason="Adjacent"/>
    </robot>

# Planning Configuration
planning_scene_monitor_options:
  name: planning_scene_monitor
  robot_description: robot_description
  joint_state_topic: /joint_states
  attached_collision_object_topic: /attached_collision_object
  publish_planning_scene_topic: /publish_planning_scene
  monitored_planning_scene_topic: /monitored_planning_scene
  wait_for_initial_state_timeout: 10.0

# Kinematics
robot_description_kinematics:
  arm:
    kinematics_solver: kdl_kinematics_plugin/KDLKinematicsPlugin
    kinematics_solver_search_resolution: 0.005
    kinematics_solver_timeout: 0.05

# Planning Pipeline
planning_pipelines:
  pipeline_names:
    - ompl
  ompl:
    planning_plugin: ompl_interface/OMPLPlanner
    request_adapters: >-
      default_planner_request_adapters/AddTimeOptimalParameterization
      default_planner_request_adapters/ResolveConstraintFrames
      default_planner_request_adapters/FixWorkspaceBounds
      default_planner_request_adapters/FixStartStateBounds
      default_planner_request_adapters/FixStartStateCollision
      default_planner_request_adapters/FixStartStatePathConstraints
    start_state_max_bounds_error: 0.1

# OMPL Planning Configuration
ompl:
  planning_plugin: ompl_interface/OMPLPlanner
  arm:
    planner_configs:
      - RRTConnect
      - RRT
      - PRM
    default_planner_config: RRTConnect
    projection_evaluator: joints(joint1,joint2)
    longest_valid_segment_fraction: 0.005

# Trajectory Execution
trajectory_execution:
  allowed_execution_duration_scaling: 1.2
  allowed_goal_duration_margin: 0.5
  allowed_start_tolerance: 0.01

moveit_controller_manager: moveit_simple_controller_manager/MoveItSimpleControllerManager

moveit_simple_controller_manager:
  controller_names:
    - arm_controller
    - gripper_controller
  arm_controller:
    type: FollowJointTrajectory
    action_ns: follow_joint_trajectory
    default: true
    joints:
      - joint1
      - joint2
      - joint3
      - joint4
  gripper_controller:
    type: GripperCommand
    action_ns: gripper_cmd
    default: true
    joints:
      - gripper_left_joint

